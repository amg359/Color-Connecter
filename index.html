<script>
  let yourColor = '';
  let yourCode = '';

  function generateColor() {
    yourColor = getRandomColor();
    yourCode = generateCode();
    document.getElementById('color-display').style.backgroundColor = yourColor;
    document.getElementById('code-display').textContent = `Your Code: ${yourCode}`;
    
    // Save the color information and increase the connection count in local storage
    const connectionData = { color: yourColor, count: 0 };
    localStorage.setItem(yourCode, JSON.stringify(connectionData));
  }

  function getRandomColor() {
    const letters = '0123456789ABCDEF';
    let color = '#';
    for (let i = 0; i < 6; i++) {
      color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
  }

  function generateCode() {
    return Math.floor(Math.random() * 10000).toString().padStart(4, '0');
  }

  function connectWithCode() {
    document.getElementById('connect-color-input').style.display = 'inline-block';
    document.getElementById('connect-color-input').focus();
    hideConnectedElements();
  }

  function validateAndConnect() {
    const friendCode = document.getElementById('connect-color-input').value;
    const connectedData = localStorage.getItem(friendCode);

    if (/^\d{4}$/.test(friendCode) && friendCode !== yourCode && connectedData) {
      const connectionData = JSON.parse(connectedData);
      connectionData.count++; // Increase the connection count
      localStorage.setItem(friendCode, JSON.stringify(connectionData));

      document.getElementById('connected-color-display').style.display = 'block';
      document.getElementById('connected-color-display').style.backgroundColor = connectionData.color;
      document.getElementById('connected-color-text').textContent = `Connected Color (Connections: ${connectionData.count})`;
    } else {
      alert('Please enter a valid 4-digit code that is not your own, or the code may not exist.');
      hideConnectedElements();
    }

    // Reset the input field and hide it
    document.getElementById('connect-color-input').value = '';
    document.getElementById('connect-color-input').style.display = 'none';
  }

  function hideConnectedElements() {
    document.getElementById('connected-color-display').style.display = 'none';
  }
</script>
